# 参照文セット設計

本ドキュメントでは、Semantic Candidate Rankerで使用される参照文セットの設計思想と構成について解説します。

## 1. 設計目標

### 目的

「自然な英語の平文」を代表するベンチマークセットを構築する。

### 要件

1. **多様性**: 様々な文体・トピックをカバー
2. **中立性**: 特定の分野に偏らない
3. **適切な長さ**: 暗号解読の平文候補と同程度
4. **一般性**: 固有名詞や専門用語を最小限に

## 2. カテゴリー構成

約300文を4つのカテゴリーに分類。

### 会話文（Dialogue）- 約75文

日常会話で使われる表現。

```
"i don't think that's a good idea"
"what time should we meet tomorrow"
"can you help me with this problem"
```

**特徴**:
- 一人称・二人称の使用
- 疑問文・依頼文が多い
- カジュアルな表現

### 叙述文（Narrative）- 約75文

物語や描写に使われる表現。

```
"the sun set behind the mountains"
"she walked slowly down the empty street"
"the room was dark and quiet"
```

**特徴**:
- 三人称視点
- 過去形が多い
- 情景描写

### 技術文（Technical）- 約75文

システムメッセージや技術的な説明。

```
"the system requires a valid input"
"please enter your password to continue"
"the file has been saved successfully"
```

**特徴**:
- 受動態が多い
- 指示・説明的な表現
- 定型的なフレーズ

### 一般文（Miscellaneous）- 約75文

上記に分類されない一般的な表現。

```
"today is a beautiful day"
"the price has increased significantly"
"there are many ways to solve this"
```

**特徴**:
- 事実の陳述
- 意見・判断
- 抽象的な表現

## 3. 文の選定基準

### 含める文

- 一般的な英語表現
- 文法的に正しい文
- 意味が明確な文
- 10-100文字程度の長さ

### 除外する文

- 固有名詞（人名、地名、ブランド名）
- 専門用語・技術用語
- スラング・俗語
- 文化特有の表現
- 不完全な文
- 記号や数字が多い文

## 4. 正規化との整合性

参照文も入力候補と同じ正規化処理を適用。

```
元の文:    "I'll be there in a few minutes."
正規化後:  "i'll be there in a few minutes"
```

### 正規化ルール

1. 小文字化
2. 連続空白の圧縮
3. 前後空白の除去
4. アポストロフィの保持

## 5. 重心（Centroid）の特性

### 理論的背景

300文のEmbeddingの平均は、「一般的な英語文」の特徴を持つベクトルとなる。

```
centroid = normalize(Σ embedding_i / 300)
```

### 期待される効果

- 自然な英語文は重心に近い
- 意味不明な文字列は重心から遠い
- 特定のトピックに偏らない評価

### 可視化イメージ

```
          Embedding空間（2D簡略図）

    技術文 ●
            ╲
             ╲
    会話文 ●──── ★ 重心 ────● 叙述文
             ╱
            ╱
    一般文 ●


    意味不明 ×（重心から遠い）
```

## 6. Top-k選択の効果

### 問題

重心だけでは、たまたま似た表現が1つあるだけで高スコアになる可能性。

### 解決策

上位k個の参照文との平均類似度も考慮。

```
k=5の場合:
  - 5つの異なる参照文と類似している必要
  - 偶然の一致を減らす
```

### kの影響

| k値 | 特徴 |
|-----|------|
| 3 | 厳格（高い一致を要求） |
| 5 | 標準（バランス） |
| 7 | 寛容（緩い一致を許容） |

## 7. 暗号解読への最適化

### 平文の特徴

暗号解読で得られる平文候補は、以下の特徴を持つことが多い：

1. **句読点の欠落**: 暗号化時に除去されることがある
2. **大文字/小文字の混在**: 復号後に不明確
3. **空白の不正確さ**: 単語区切りが失われることがある
4. **部分的な平文**: 全文ではなく断片的

### 対応策

- 参照文も句読点なしで正規化
- 大文字/小文字を区別しない
- 短い文も含める
- 文の断片も自然な表現として許容

## 8. 多言語対応について

### 現在の実装

- 入力候補: 英語のみ
- 参照文: 英語のみ
- UI: 日本語/英語切り替え可能

### 理由

- Embeddingモデル（all-MiniLM-L6-v2）は英語に最適化
- 暗号解読の主な対象は英語テキスト
- 日本語の自然さ評価には別のモデルが必要

### 将来的な拡張

日本語対応を行う場合：
1. 多言語Embeddingモデルの採用
2. 日本語参照文セットの作成
3. 日本語特有の正規化ルール追加

## 9. メンテナンス指針

### 参照文の追加基準

- 既存カテゴリーのバランスを維持
- 重複・類似文を避ける
- 一般性を維持

### 参照文の削除基準

- 古い表現・死語
- 文化的に問題のある表現
- 特定分野への偏り

## 10. 参考資料

- [Sentence Embeddings for Semantic Similarity](https://arxiv.org/abs/1908.10084)
- [Evaluating Sentence Embeddings](https://aclanthology.org/W16-0903/)
